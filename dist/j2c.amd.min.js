define(function(){"use strict";function e(e,n){for(var l in n)v.call(n,l)&&(!l.indexOf("$")||l in e||(e[l]=n[l]));return e}function n(e,n){var l,t,r=[];for(t in n)if(v.call(n,t))for(l in e)v.call(e,l)&&r.push(e[l]+n[t]);return r}function l(e){for(var n,l=[],t=[],r=0;n=A.exec(e);)switch(n[0]){case"(":r++;break;case")":r--;break;case",":if(r)break;l.push(n.index)}for(n=l.length;n--;)t.unshift(e.slice(l[n]+1)),e=e.slice(0,l[n]);return t.unshift(e),t}function t(e,l){for(var t,r,a=[],i=[];r=S.exec(e);)"&"==r[0]&&a.push(r.index);for(r=a.length;r--;)i.unshift(e.slice(a[r]+1)),e=e.slice(0,a[r]);for(i.unshift(e),1===i.length&&i.unshift(""),t=[i[0]],r=1;r<i.length;r++)t=n(t,n(l,[i[r]]));return t.join(",")}function r(e){return function n(l){if(m.call(l)===w)for(var t=0;t<l.length;t++)n(l[t]);else e(l)}}function a(e){return"-"+e.toLowerCase()}function i(e,n,l,t,r){var u,o,c;if(null!=t)switch(m.call(t=t.valueOf())){case w:for(u=0;u<t.length;u++)i(e,n,l,t[u],r);break;case _:l=l&&l+"-";for(u in t)if(v.call(t,u))if(o=t[u],/\$/.test(u))for(c in u=u.split("$"))v.call(u,c)&&i(e,n,l+u[c],o,r);else i(e,n,l+u,o,r);break;default:u=l.replace(/_/g,"-").replace(/[A-Z]/g,a),!r||"animation-name"!=u&&"animation"!=u&&"list-style"!=u||(t=t.split(",").map(function(n){return n.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),u?n.decl(u,t):n.raw(t)}}function u(e,n,l,t,a,u,c){for(var s=0;s<e.atruleHandlers.length;s++)if(e.atruleHandlers[s](e,n,l,t,a,u,c))return;if(!l[3]&&/^global$/.test(l[2]))o(e,n,a,t,0,c);else if(!l[3]&&/^local$/.test(l[2]))o(e,n,a,t,1,c);else if(l[3]&&/^adopt$/.test(l[2])){if(!u||c)return n.err("@adopt global or nested: "+l[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(l[3]))return n.err("bad adopter "+JSON.stringify(l[3])+" in "+l[0]);s=[],r(function(e,t){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(t=e+"")?s.push(t.replace(/\./g,"")):n.err("bad adoptee "+JSON.stringify(e)+" in "+l[0])})(t),s.length&&(e.localize(l[3]=l[3].replace(/\./g,"")),e.names[l[3]]+=" "+s.join(" "))}else!l[3]&&/^(?:namespace|import|charset)$/.test(l[2])?r(function(e){n.atrule(l[1],l[2],e)})(t):!l[3]&&/^(?:font-face|viewport)$/.test(l[2])?r(function(t){n.atrule(l[1],l[2],l[3],"decl"),i(e,n,"",t,u),n._atrule()})(t):l[3]&&/^(?:media|supports|page|keyframes)$/.test(l[2])?(u&&"keyframes"==l[2]&&(l[3]=l[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,e.localizeReplacer)),"page"==l[2]?(n.atrule(l[1],l[2],l[3],"decl"),i(e,n,"",t,u)):(n.atrule(l[1],l[2],l[3],"rule"),o(e,n,"keyframes"==l[2]?"":a,t,u,c+1)),n._atrule()):n.err("Unsupported at-rule: "+l[0])}function o(e,n,r,a,c,s){var f,p,h,g;switch(m.call(a)){case _:for(f in a)if(v.call(a,f))if(p=a[f],r.length>0&&/^[-\w$]+$/.test(f))if(h||(h=1,n.rule(r)),/\$/.test(f))for(g in f=f.split("$"))v.call(f,g)&&i(e,n,f[g],p,c);else i(e,n,f,p,c);else/^@/.test(f)?(h=0,u(e,n,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*(.*?)\s*$/.exec(f)||[f,"@","",""],p,r,c,s)):(h=0,o(e,n,r.length>0&&(/,/.test(r)||/,/.test(f))?(g=l(r),l(c?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f).map(function(e){return/&/.test(e)?t(e,g):g.map(function(n){return n+e}).join(",")}).join(",")):/&/.test(f)?t(c?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f,[r]):r+(c?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f),p,c,s+1));break;case w:for(f=0;f<a.length;f++)o(e,n,r,a[f],c,s);break;case z:r.length&&n.rule(r),n.raw(a)}}function c(e,n){var l;return n?e:{init:function(){l=0,e.init()},done:function(n){return l&&(e._rule(),l=0),e.done(n)},atrule:function(n,t,r,a){l&&(e._rule(),l=0),e.atrule(n,t,r,a)},_atrule:function(n){l&&(e._rule(),l=0),e._atrule(n)},rule:function(n){n!==l&&(l&&e._rule(),e.rule(n),l=n)}}}function s(e){return":global("+e+")"}function f(e,n,l){return l={},l[e]=n,l}function p(e,n,l){if(arguments.length<3){var t=p.bind.apply(p,[null].concat([].slice.call(arguments,0)));return t.toString=function(){return"@"+e+" "+n},t}return f("@"+e+" "+n,l)}function h(){function n(e){return A.names[e]||(A.names[e]=e+A.suffix),A.names[e].match(/^\S+/)}function l(e,l,t,r,a){return l||t||r+n(a)}var t,a,h=[{init:function(){t=[],a=[]},done:function(e){if(0!=a.length)throw new Error("j2c error(s): "+JSON.stringify(a,null,2)+"in context:\n"+t.join(""));return e?t:t.join("")},err:function(e){a.push(e),t.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){t.push(e,A.endline)},atrule:function(e,n,l,r){t.push(e,l&&" ",l,r?" {":";",A.endline)},_atrule:function(){t.push("}",A.endline)},rule:function(e){t.push(e," {",A.endline)},_rule:function(){t.push("}",A.endline)},decl:function(e,n){t.push(e,":",n,";",A.endline)}}],d=[c],v=[],A={at:p,global:s,kv:f,names:{},endline:"\n",suffix:"__j2c-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36),plugins:[],sheet:function(e){return h[0].init(),o(S[0],h[0],"",e,1,0),h[0].done()},inline:function(e,n){return h[1].init(),i(S[1],h[1],"",e,!(n&&n.global)),h[1].done()}},S=[{localizeReplacer:l,localize:n,names:A.names,atruleHandlers:v,atrule:u,decl:i,rule:o},{localizeReplacer:l,localize:n,names:A.names,decl:i}],Z=r(function(e){A.plugins.push(e),m.call(e)===b&&(e=e(A)),e&&(m.call(e.filter)===b&&d.push(e.filter),m.call(e.atrule)===b&&v.push(e.atrule),m.call(e.sink)===b&&(h=e.sink()),m.call(e.names)===_&&(A.names=e.names),m.call(e.suffix)===z&&(A.suffix=e.suffix),m.call(e.plugins)===w&&Z(e.plugins))});Z(g.slice.call(arguments)),h[1]=h[1]||{init:h[0].init,done:h[0].done,raw:h[0].raw,err:h[0].err,decl:h[0].decl};for(var k=0;k<2;k++)for(var x=d.length;x--;)h[k]=$(e(d[x](h[k],!!k),h[k]));return $(A),A}var g=[],d={},m=d.toString,w=m.call(g),_=m.call(d),z=m.call(""),b=m.call(m),v=d.hasOwnProperty,$=Object.freeze||function(e){return e},A=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,S=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;return h});