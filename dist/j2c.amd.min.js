define(function(){"use strict";function e(e,n){for(var r in n)k.call(n,r)&&(!r.indexOf("$")||r in e||(e[r]=n[r]));return e}function n(e,n){var r,l,t=[];for(l in n)if(k.call(n,l))for(r in e)k.call(e,r)&&t.push(e[r]+n[l]);return t}function r(e){for(var n,r=[],l=[],t=0;n=O.exec(e);)switch(n[0]){case"(":t++;break;case")":t--;break;case",":if(t)break;r.push(n.index)}for(n=r.length;n--;)l.unshift(e.slice(r[n]+1)),e=e.slice(0,r[n]);return l.unshift(e),l}function l(e,r){for(var l,t,a=[],i=[];t=S.exec(e);)"&"==t[0]&&a.push(t.index);for(t=a.length;t--;)i.unshift(e.slice(a[t]+1)),e=e.slice(0,a[t]);for(i.unshift(e),1===i.length&&i.unshift(""),l=[i[0]],t=1;t<i.length;t++)l=n(l,n(r,[i[t]]));return l.join(",")}function t(e){return function n(r){if(v.call(r)===z)for(var l=0;l<r.length;l++)n(r[l]);else e(r)}}function a(e){for(;y.length<e;)y+=Math.floor(4294967296*Math.random()).toString(36);var n="_"+y.slice(0,e);return y=y.slice(e),n}function i(e){return"-"+e.toLowerCase()}function u(e,n,r,l,t){var a,c,o;if(null!=l)switch(v.call(l=l.valueOf())){case z:for(a=0;a<l.length;a++)u(e,n,r,l[a],t);break;case b:for(a in l)if(k.call(l,a))if(c=l[a],a.indexOf("$")!==-1)for(o in a=a.split("$"))k.call(a,o)&&u(e,n,r+a[o],c,t);else u(e,n,r+a,c,t);break;default:if(!r)return n.raw(l);a=r.replace(/[A-Z]/g,i),!t||"animation-name"!=a&&"animation"!=a||(l=l.split(/,(?!\s*(?:start|end)\b)/).map(function(n){return n.replace(/^\s*(?:(var\([^),]+(?:\)|$))|(?:var\([^,]+,\s*)??:?global\(\s*([_A-Za-z][-\w]*)\s*\)|(?:var\([^,]+,\s*)??()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),n.decl(a,l)}}function c(e,n,t,a,i,o){var f,s,p,h;switch(v.call(a)){case b:for(f in a)if(k.call(a,f))if(s=a[f],t.length>0&&/^\*?[-\w$]+$/.test(f))if(p||(p=1,n.rule(t)),f.indexOf("$")!==-1)for(h in f=f.split("$"))k.call(f,h)&&u(e,n,f[h],s,i);else u(e,n,f,s,i);else if("@"===f.charAt(0))p=0,e.atrules(e,n,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*([\s\S]*?)\s*$/.exec(f)||[f,"@","",""],s,t,i,o);else{if(p=0,""===f){n._rule(),n.err("Invalid selector ''");continue}c(e,n,t.length>0&&t.indexOf(",")+f.indexOf(",")!==-2?(h=r(t),r(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f).map(function(e){return e.indexOf("&")!==-1?l(e,h):h.map(function(n){return n+e}).join(",")}).join(",")):f.indexOf("&")!==-1?l(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f,[t]):t+(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f),s,i,o+1)}break;case z:for(f=0;f<a.length;f++)c(e,n,t,a[f],i,o);break;case x:t.length&&n.rule(t),n.raw(a)}}function o(e,n){var r;return n?e:{init:function(){r="",e.init()},done:function(){return""!==r&&(e._rule(),r=""),e.done()},atrule:function(n,l,t,a){""!==r&&(e._rule(),r=""),e.atrule(n,l,t,a)},_atrule:function(n){""!==r&&(e._rule(),r=""),e._atrule(n)},rule:function(n){n!==r&&(""!==r&&e._rule(),e.rule(n),r=n)},_rule:function(){r&&(e._rule(),r="")}}}function f(e){return function(n,r,l,a,i,u,o){if("global"!==l[2]||l[3])if("local"!==l[2]||l[3])if("adopt"===l[2]&&l[3]){if(!u||o)return r.err("@adopt global or nested: "+l[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(l[3]))return r.err("bad adopter "+JSON.stringify(l[3])+" in "+l[0]);var f=[];t(function(e,n){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(n=e+"")?f.push(n.replace(/\./g,"")):r.err("bad adoptee "+JSON.stringify(e)+" in "+l[0])})(a),f.length&&(n.localize(l[3]=l[3].replace(/\./g,"")),n.names[l[3]]+=" "+f.join(" "))}else u&&"keyframes"===l[2]&&l[3]&&(l[3]=l[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,n.localizeReplacer)),e(n,r,l,a,i,u,o);else c(n,r,i,a,1,o);else c(n,r,i,a,0,o)}}function s(e){return function(n,r,l,i,o,f,s){if("namespace"!==l[2]&&"import"!==l[2]&&"charset"!==l[2]||l[3])if("font-face"===l[2]||"page"===l[2]||"viewport"===l[2])t(function(e){r.atrule(l[1],l[2],l[3],"decl"),u(n,r,"",e,f),r._atrule()})(i);else if(("media"===l[2]||"supports"===l[2])&&l[3]||"keyframes"===l[2]){if("keyframes"===l[2]&&""===l[3]){if(""===o)return void r.err("Unexpected anonymous @keyframes out of selector");l[3]=a(8),r.rule(o),r.decl("animation-name",l[3])}r.atrule(l[1],l[2],l[3],"rule"),c(n,r,"keyframes"==l[2]?"":o,i,f,s+1),r._atrule()}else e(n,r,l,i,o,f,s);else t(function(e){r.atrule(l[1],l[2],e)})(i)}}function p(e,n,r){n.err("Unsupported at-rule: "+r[0])}function h(e,n,r,l){l.init();try{e(r,l,"",n,1,0)}catch(e){l.err(e instanceof Error?e.stack:""+e)}return l.done()}function g(e,n){return e?e.replace(/\W+/g,"_")+"__":a(n)+"__"}function d(n,r,l,t,a,i){function o(e){return k.call(f,e)||(f[e]=n+e),f[e].match(/^\S+/)}for(var f={},s={atrules:l,names:f,localize:o,localizeReplacer:function(e,n,r,l,t){return n||r||l+o(t)}},p={ns:function(e){var n=g(e,r);return k.call(t,n)||(t[n]=d(n,r,l,t,a,i)),t[n]},names:f,prefix:n,sheet:function(e){return h(c,e,s,a[0])},inline:function(e){return h(u,e,s,a[1])}},_=i.length;_--;)e(p,i[_]);return p}function _(n){n=n||{};var r,l,a,i=[{init:function(){r=[],l=[]},done:function(e){if(0!=l.length)throw new Error("j2c error(s): "+JSON.stringify(l,null,2)+" in context:\n"+r.join(""));return e?r:r.join("")},err:function(e){l.push(e),r.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){r.push(e,"\n")},atrule:function(e,n,l,t){r.push(e,l&&" ",l,t?" {\n":";\n")},_atrule:function(){r.push("}\n")},rule:function(e){r.push(e," {\n")},_rule:function(){r.push("}\n")},decl:function(e,n){r.push(e,":",n,";\n")}}],u=[o],c=[],f=[],s=7,p={},h=$;v.call(n.plugins)===z&&t(function(e){if(v.call(e)!==b)throw new Error("bad plugin, object expected, got "+v.call(e));v.call(e.filter)===A&&u.push(e.filter),v.call(e.atrule)===A&&c.push(e.atrule),v.call(e.sink)===A&&(i=e.sink()),v.call(e.set)===b&&f.push(e.set)})(n.plugins),v.call(n.prefix)===m&&(s=n.prefix),a=g(v.call(n.prefix)===x?n.prefix:null,s);for(var _=c.length;_--;)h=c[_](h);for(i[1]=i[1]||{init:i[0].init,done:i[0].done,raw:i[0].raw,err:i[0].err,decl:i[0].decl},_=0;_<2;_++)for(var w=u.length;w--;)i[_]=Z(e(u[w](i[_],!!_),i[_]));return Z(d(a,s,h,p,i,f))}var w={},v=w.toString,z=v.call([]),m=v.call(0),b=v.call(w),x=v.call(""),A=v.call(v),k=w.hasOwnProperty,Z=Object.freeze||function(e){return e},O=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,S=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,y="",$=f(s(p));return _});