define(function(){"use strict";function e(e,n){for(var l in n)$.call(n,l)&&(!l.indexOf("$")||l in e||(e[l]=n[l]));return e}function n(e,n){var l,r,t=[];for(r in n)if($.call(n,r))for(l in e)$.call(e,l)&&t.push(e[l]+n[r]);return t}function l(e){for(var n,l=[],r=[],t=0;n=A.exec(e);)switch(n[0]){case"(":t++;break;case")":t--;break;case",":if(t)break;l.push(n.index)}for(n=l.length;n--;)r.unshift(e.slice(l[n]+1)),e=e.slice(0,l[n]);return r.unshift(e),r}function r(e,l){for(var r,t,a=[],i=[];t=Z.exec(e);)"&"==t[0]&&a.push(t.index);for(t=a.length;t--;)i.unshift(e.slice(a[t]+1)),e=e.slice(0,a[t]);for(i.unshift(e),1===i.length&&i.unshift(""),r=[i[0]],t=1;t<i.length;t++)r=n(r,n(l,[i[t]]));return r.join(",")}function t(e){return function n(l){if(w.call(l)===m)for(var r=0;r<l.length;r++)n(l[r]);else e(l)}}function a(e){for(;k.length<e;)k+=Math.floor(4294967296*Math.random()).toString(36);var n="_"+k.slice(0,e);return k=k.slice(e),n}function i(e){return"-"+e.toLowerCase()}function u(e,n,l,r,t){var a,c,s;if(null!=r)switch(w.call(r=r.valueOf())){case m:for(a=0;a<r.length;a++)u(e,n,l,r[a],t);break;case z:l=l&&l+"-";for(a in r)if($.call(r,a))if(c=r[a],/\$/.test(a))for(s in a=a.split("$"))$.call(a,s)&&u(e,n,l+a[s],c,t);else u(e,n,l+a,c,t);break;default:if(!l)return n.raw(r);a=l.replace(/_/g,"-").replace(/[A-Z]/g,i),!t||"animation-name"!=a&&"animation"!=a&&"list-style"!=a||(r=r.split(",").map(function(n){return n.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),n.decl(a,r)}}function c(e,n,l,r,a,i,c){for(var o=0;o<e.atruleHandlers.length;o++)if(e.atruleHandlers[o](e,n,l,r,a,i,c))return;if(!l[3]&&/^global$/.test(l[2]))s(e,n,a,r,0,c);else if(!l[3]&&/^local$/.test(l[2]))s(e,n,a,r,1,c);else if(l[3]&&/^adopt$/.test(l[2])){if(!i||c)return n.err("@adopt global or nested: "+l[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(l[3]))return n.err("bad adopter "+JSON.stringify(l[3])+" in "+l[0]);o=[],t(function(e,r){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(r=e+"")?o.push(r.replace(/\./g,"")):n.err("bad adoptee "+JSON.stringify(e)+" in "+l[0])})(r),o.length&&(e.localize(l[3]=l[3].replace(/\./g,"")),e.names[l[3]]+=" "+o.join(" "))}else!l[3]&&/^(?:namespace|import|charset)$/.test(l[2])?t(function(e){n.atrule(l[1],l[2],e)})(r):!l[3]&&/^(?:font-face|viewport)$/.test(l[2])?t(function(r){n.atrule(l[1],l[2],l[3],"decl"),u(e,n,"",r,i),n._atrule()})(r):l[3]&&/^(?:media|supports|page|keyframes)$/.test(l[2])?(i&&"keyframes"==l[2]&&(l[3]=l[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,e.localizeReplacer)),"page"==l[2]?(n.atrule(l[1],l[2],l[3],"decl"),u(e,n,"",r,i)):(n.atrule(l[1],l[2],l[3],"rule"),s(e,n,"keyframes"==l[2]?"":a,r,i,c+1)),n._atrule()):n.err("Unsupported at-rule: "+l[0])}function s(e,n,t,a,i,o){var f,p,g,h;switch(w.call(a)){case z:for(f in a)if($.call(a,f))if(p=a[f],t.length>0&&/^[-\w$]+$/.test(f))if(g||(g=1,n.rule(t)),/\$/.test(f))for(h in f=f.split("$"))$.call(f,h)&&u(e,n,f[h],p,i);else u(e,n,f,p,i);else/^@/.test(f)?(g=0,c(e,n,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*(.*?)\s*$/.exec(f)||[f,"@","",""],p,t,i,o)):(g=0,s(e,n,t.length>0&&(/,/.test(t)||/,/.test(f))?(h=l(t),l(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f).map(function(e){return/&/.test(e)?r(e,h):h.map(function(n){return n+e}).join(",")}).join(",")):/&/.test(f)?r(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f,[t]):t+(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f),p,i,o+1));break;case m:for(f=0;f<a.length;f++)s(e,n,t,a[f],i,o);break;case b:t.length&&n.rule(t),n.raw(a)}}function o(e,n){var l;return n?e:{init:function(){l=0,e.init()},done:function(n){return l&&(e._rule(),l=0),e.done(n)},atrule:function(n,r,t,a){l&&(e._rule(),l=0),e.atrule(n,r,t,a)},_atrule:function(n){l&&(e._rule(),l=0),e._atrule(n)},rule:function(n){n!==l&&(l&&e._rule(),e.rule(n),l=n)}}}function f(e){return":global("+e+")"}function p(e,n,l){return l={},l[e]=n,l}function g(e,n,l){if(arguments.length<3){var r=g.bind.apply(g,[null].concat([].slice.call(arguments,0)));return r.toString=function(){return"@"+e+" "+n},r}return p("@"+e+" "+n,l)}function h(n){function l(e){return Z.names[e]||(Z.names[e]=e+Z.suffix),Z.names[e].match(/^\S+/)}function r(e,n,r,t,a){return n||r||t+l(a)}n=n||{};var i,h,d=[{init:function(){i=[],h=[]},done:function(e){if(0!=h.length)throw new Error("j2c error(s): "+JSON.stringify(h,null,2)+"in context:\n"+i.join(""));return e?i:i.join("")},err:function(e){h.push(e),i.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){i.push(e,Z.endline)},atrule:function(e,n,l,r){i.push(e,l&&" ",l,r?" {":";",Z.endline)},_atrule:function(){i.push("}",Z.endline)},rule:function(e){i.push(e," {",Z.endline)},_rule:function(){i.push("}",Z.endline)},decl:function(e,n){i.push(e,":",n,";",Z.endline)}}],$=[o],A=[],Z={at:g,global:f,kv:p,names:{},endline:"\n",suffix:a(7),plugins:[],sheet:function(e){return d[0].init(),s(k[0],d[0],"",e,1,0),d[0].done()},inline:function(e,n){return d[1].init(),u(k[1],d[1],"",e,!(n&&n.global)),d[1].done()}},k=[{localizeReplacer:r,localize:l,names:Z.names,atruleHandlers:A,atrule:c,decl:u,rule:s},{localizeReplacer:r,localize:l,names:Z.names,decl:u}];w.call(n.plugins)===m&&t(function(e){Z.plugins.push(e),w.call(e)===v&&(e=e(Z)),e&&(w.call(e.filter)===v&&$.push(e.filter),w.call(e.atrule)===v&&A.push(e.atrule),w.call(e.sink)===v&&(d=e.sink()))})(n.plugins),w.call(n.names)===z&&(Z.names=n.names),w.call(n.suffix)===b&&(Z.suffix=n.suffix),w.call(n.suffix)===_&&(Z.suffix=a(n.suffix)),w.call(n.endline)===b&&(Z.endline=n.endine),d[1]=d[1]||{init:d[0].init,done:d[0].done,raw:d[0].raw,err:d[0].err,decl:d[0].decl};for(var S=0;S<2;S++)for(var R=$.length;R--;)d[S]=x(e($[R](d[S],!!S),d[S]));return x(Z),Z}var d={},w=d.toString,m=w.call([]),_=w.call(0),z=w.call(d),b=w.call(""),v=w.call(w),$=d.hasOwnProperty,x=Object.freeze||function(e){return e},A=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,Z=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,k="";return h});