"use strict";function defaults(e,n){for(var t in n)own.call(n,t)&&(!t.indexOf("$")||t in e||(e[t]=n[t]));return e}function cartesian(e,n){var t,r,a=[];for(r in n)if(own.call(n,r))for(t in e)own.call(e,t)&&a.push(e[t]+n[r]);return a}function splitSelector(e){for(var n,t=[],r=[],a=0;n=selectorTokenizer.exec(e);)switch(n[0]){case"(":a++;break;case")":a--;break;case",":if(a)break;t.push(n.index)}for(n=t.length;n--;)r.unshift(e.slice(t[n]+1)),e=e.slice(0,t[n]);return r.unshift(e),r}function ampersand(e,n){for(var t,r,a=[],l=[];r=ampersandTokenizer.exec(e);)"&"==r[0]&&a.push(r.index);for(r=a.length;r--;)l.unshift(e.slice(a[r]+1)),e=e.slice(0,a[r]);for(l.unshift(e),1===l.length&&l.unshift(""),t=[l[0]],r=1;r<l.length;r++)t=cartesian(t,cartesian(n,[l[r]]));return t.join(",")}function flatIter(e){return function n(t){if(type.call(t)===ARRAY)for(var r=0;r<t.length;r++)n(t[r]);else e(t)}}function decamelize(e){return"-"+e.toLowerCase()}function declarations(e,n,t,r,a){var l,i,o;if(null!=r)switch(type.call(r=r.valueOf())){case ARRAY:for(l=0;l<r.length;l++)declarations(e,n,t,r[l],a);break;case OBJECT:t=t&&t+"-";for(l in r)if(own.call(r,l))if(i=r[l],/\$/.test(l))for(o in l=l.split("$"))own.call(l,o)&&declarations(e,n,t+l[o],i,a);else declarations(e,n,t+l,i,a);break;default:l=t.replace(/_/g,"-").replace(/[A-Z]/g,decamelize),!a||"animation-name"!=l&&"animation"!=l&&"list-style"!=l||(r=r.split(",").map(function(n){return n.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),l?n.decl(l,r):n.raw(r)}}function atRules(e,n,t,r,a,l,i){for(var o=0;o<e.$atHandlers.length;o++)if(e.$atHandlers[o](e,n,t,r,a,l,i))return;if(!t[3]&&/^global$/.test(t[2]))rules(e,n,a,r,0,i);else if(!t[3]&&/^local$/.test(t[2]))rules(e,n,a,r,1,i);else if(t[3]&&/^adopt$/.test(t[2])){if(!l||i)return n.err("@adopt global or nested: "+t[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(t[3]))return n.err("bad adopter "+JSON.stringify(t[3])+" in "+t[0]);o=[],flatIter(function(e,r){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(r=e+"")?o.push(r.replace(/\./g,"")):n.err("bad adoptee "+JSON.stringify(e)+" in "+t[0])})(r),o.length&&(e.localize(t[3]=t[3].replace(/\./g,"")),e.names[t[3]]+=" "+o.join(" "))}else!t[3]&&/^(?:namespace|import|charset)$/.test(t[2])?flatIter(function(e){n.atrule(t[1],t[2],e)})(r):!t[3]&&/^(?:font-face|viewport)$/.test(t[2])?flatIter(function(r){n.atrule(t[1],t[2],t[3],"decl"),declarations(e,n,"",r,l),n._atrule()})(r):t[3]&&/^(?:media|supports|page|keyframes)$/.test(t[2])?(l&&"keyframes"==t[2]&&(t[3]=t[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,e.localizeReplacer)),"page"==t[2]?(n.atrule(t[1],t[2],t[3],"decl"),declarations(e,n,"",r,l)):(n.atrule(t[1],t[2],t[3],"rule"),rules(e,n,"keyframes"==t[2]?"":a,r,l,i+1)),n._atrule()):n.err("Unsupported at-rule: "+t[0])}function rules(e,n,t,r,a,l){var i,o,s,c;switch(type.call(r)){case OBJECT:for(i in r)if(own.call(r,i))if(o=r[i],t.length>0&&/^[-\w$]+$/.test(i))if(s||(s=1,n.rule(t)),/\$/.test(i))for(c in i=i.split("$"))own.call(i,c)&&declarations(e,n,i[c],o,a);else declarations(e,n,i,o,a);else/^@/.test(i)?(s=0,atRules(e,n,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*(.*?)\s*$/.exec(i)||[i,"@","",""],o,t,a,l)):(s=0,rules(e,n,t.length>0&&(/,/.test(t)||/,/.test(i))?(c=splitSelector(t),splitSelector(a?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i).map(function(e){return/&/.test(e)?ampersand(e,c):c.map(function(n){return n+e}).join(",")}).join(",")):/&/.test(i)?ampersand(a?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i,[t]):t+(a?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i),o,a,l+1));break;case ARRAY:for(i=0;i<r.length;i++)rules(e,n,t,r[i],a,l);break;case STRING:t.length&&n.rule(t),n.raw(r)}}function closeSelectors(e,n){var t;return n?e:{init:function(){t=0,e.init()},done:function(n){return t&&(e._rule(),t=0),e.done(n)},atrule:function(n,r,a,l){t&&(e._rule(),t=0),e.atrule(n,r,a,l)},_atrule:function(n){t&&(e._rule(),t=0),e._atrule(n)},rule:function(n){n!==t&&(t&&e._rule(),e.rule(n),t=n)}}}function global(e){return":global("+e+")"}function kv(e,n,t){return t={},t[e]=n,t}function at(e,n,t){if(arguments.length<3){var r=at.bind.apply(at,[null].concat([].slice.call(arguments,0)));return r.toString=function(){return"@"+e+" "+n},r}return kv("@"+e+" "+n,t)}function j2c(){function e(e){if(!f.length){i.push(function(e,n){return n?l[1]||{init:l[0].init,decl:l[0].decl,done:l[0].done,err:l[0].err,raw:l[0].raw}:l[0]});for(var n=0;n<2;n++)for(var t=i.length;t--;)f[n]=freeze(defaults(i[t](f[n],!!n),f[n]))}return f[e]}function n(e){return s.names[e]||(s.names[e]=e+s.suffix),s.names[e].match(/^\S+/)}function t(e,t,r,a,l){return t||r||a+n(l)}var r,a,l=[{init:function(){r=[],a=[]},done:function(e){if(0!=a.length)throw new Error("j2c error(s): "+JSON.stringify(a,null,2)+"in context:\n"+r.join(""));return e?r:r.join("")},err:function(e){a.push(e),r.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){r.push(e,s.endline)},atrule:function(e,n,t,a){r.push(e,t&&" ",t,a?" {":";",s.endline)},_atrule:function(){r.push("}",s.endline)},rule:function(e){r.push(e," {",s.endline)},_rule:function(){r.push("}",s.endline)},decl:function(e,n){r.push(e,":",n,";",s.endline)}}],i=[closeSelectors],o=[],s={at:at,global:global,kv:kv,names:{},endline:"\n",suffix:"__j2c-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36),plugins:[],sheet:function(n){var t=e(0);return t.init(),rules(c[0],t,"",n,1,0),t.done()},inline:function(n,t){var r=e(1);return r.init(),declarations(c[1],r,"",n,!(t&&t.global)),r.done()}},c=[{localizeReplacer:t,localize:n,names:s.names,$atHandlers:o,atrule:atRules,decl:declarations,rule:rules},{localizeReplacer:t,localize:n,names:s.names,decl:declarations}],u=flatIter(function(e){s.plugins.push(e),type.call(e)===FUNCTION&&(e=e(s)),e&&(flatIter(function(e){i.push(e)})(e.$filter||emptyArray),flatIter(function(e){o.push(e)})(e.$at||emptyArray),defaults(s.names,e.$names||emptyObject),l=e.$sink?e.$sink():l,defaults(s,e))}),f=[];return u(emptyArray.slice.call(arguments)),freeze(s),s}var emptyArray=[],emptyObject={},type=emptyObject.toString,ARRAY=type.call(emptyArray),OBJECT=type.call(emptyObject),STRING=type.call(""),FUNCTION=type.call(type),own=emptyObject.hasOwnProperty,freeze=Object.freeze||function(e){return e},selectorTokenizer=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,ampersandTokenizer=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;module.exports=j2c;