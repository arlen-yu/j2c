"use strict";function defaults(e,n){for(var t in n)own.call(n,t)&&(!t.indexOf("$")||t in e||(e[t]=n[t]));return e}function cartesian(e,n){var t,l,r=[];for(l in n)if(own.call(n,l))for(t in e)own.call(e,t)&&r.push(e[t]+n[l]);return r}function splitSelector(e){for(var n,t=[],l=[],r=0;n=selectorTokenizer.exec(e);)switch(n[0]){case"(":r++;break;case")":r--;break;case",":if(r)break;t.push(n.index)}for(n=t.length;n--;)l.unshift(e.slice(t[n]+1)),e=e.slice(0,t[n]);return l.unshift(e),l}function ampersand(e,n){for(var t,l,r=[],a=[];l=ampersandTokenizer.exec(e);)"&"==l[0]&&r.push(l.index);for(l=r.length;l--;)a.unshift(e.slice(r[l]+1)),e=e.slice(0,r[l]);for(a.unshift(e),1===a.length&&a.unshift(""),t=[a[0]],l=1;l<a.length;l++)t=cartesian(t,cartesian(n,[a[l]]));return t.join(",")}function flatIter(e){return function n(t){if(type.call(t)===ARRAY)for(var l=0;l<t.length;l++)n(t[l]);else e(t)}}function randChars(e){for(;chars.length<e;)chars+=Math.floor(4294967296*Math.random()).toString(36);var n="_"+chars.slice(0,e);return chars=chars.slice(e),n}function decamelize(e){return"-"+e.toLowerCase()}function declarations(e,n,t,l,r){var a,i,s;if(null!=l)switch(type.call(l=l.valueOf())){case ARRAY:for(a=0;a<l.length;a++)declarations(e,n,t,l[a],r);break;case OBJECT:t=t&&t+"-";for(a in l)if(own.call(l,a))if(i=l[a],/\$/.test(a))for(s in a=a.split("$"))own.call(a,s)&&declarations(e,n,t+a[s],i,r);else declarations(e,n,t+a,i,r);break;default:a=t.replace(/_/g,"-").replace(/[A-Z]/g,decamelize),!r||"animation-name"!=a&&"animation"!=a&&"list-style"!=a||(l=l.split(",").map(function(n){return n.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),a?n.decl(a,l):n.raw(l)}}function atRules(e,n,t,l,r,a,i){for(var s=0;s<e.atruleHandlers.length;s++)if(e.atruleHandlers[s](e,n,t,l,r,a,i))return;if(!t[3]&&/^global$/.test(t[2]))rules(e,n,r,l,0,i);else if(!t[3]&&/^local$/.test(t[2]))rules(e,n,r,l,1,i);else if(t[3]&&/^adopt$/.test(t[2])){if(!a||i)return n.err("@adopt global or nested: "+t[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(t[3]))return n.err("bad adopter "+JSON.stringify(t[3])+" in "+t[0]);s=[],flatIter(function(e,l){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(l=e+"")?s.push(l.replace(/\./g,"")):n.err("bad adoptee "+JSON.stringify(e)+" in "+t[0])})(l),s.length&&(e.localize(t[3]=t[3].replace(/\./g,"")),e.names[t[3]]+=" "+s.join(" "))}else!t[3]&&/^(?:namespace|import|charset)$/.test(t[2])?flatIter(function(e){n.atrule(t[1],t[2],e)})(l):!t[3]&&/^(?:font-face|viewport)$/.test(t[2])?flatIter(function(l){n.atrule(t[1],t[2],t[3],"decl"),declarations(e,n,"",l,a),n._atrule()})(l):t[3]&&/^(?:media|supports|page|keyframes)$/.test(t[2])?(a&&"keyframes"==t[2]&&(t[3]=t[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,e.localizeReplacer)),"page"==t[2]?(n.atrule(t[1],t[2],t[3],"decl"),declarations(e,n,"",l,a)):(n.atrule(t[1],t[2],t[3],"rule"),rules(e,n,"keyframes"==t[2]?"":r,l,a,i+1)),n._atrule()):n.err("Unsupported at-rule: "+t[0])}function rules(e,n,t,l,r,a){var i,s,c,o;switch(type.call(l)){case OBJECT:for(i in l)if(own.call(l,i))if(s=l[i],t.length>0&&/^[-\w$]+$/.test(i))if(c||(c=1,n.rule(t)),/\$/.test(i))for(o in i=i.split("$"))own.call(i,o)&&declarations(e,n,i[o],s,r);else declarations(e,n,i,s,r);else/^@/.test(i)?(c=0,atRules(e,n,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*(.*?)\s*$/.exec(i)||[i,"@","",""],s,t,r,a)):(c=0,rules(e,n,t.length>0&&(/,/.test(t)||/,/.test(i))?(o=splitSelector(t),splitSelector(r?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i).map(function(e){return/&/.test(e)?ampersand(e,o):o.map(function(n){return n+e}).join(",")}).join(",")):/&/.test(i)?ampersand(r?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i,[t]):t+(r?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i),s,r,a+1));break;case ARRAY:for(i=0;i<l.length;i++)rules(e,n,t,l[i],r,a);break;case STRING:t.length&&n.rule(t),n.raw(l)}}function closeSelectors(e,n){var t;return n?e:{init:function(){t=0,e.init()},done:function(n){return t&&(e._rule(),t=0),e.done(n)},atrule:function(n,l,r,a){t&&(e._rule(),t=0),e.atrule(n,l,r,a)},_atrule:function(n){t&&(e._rule(),t=0),e._atrule(n)},rule:function(n){n!==t&&(t&&e._rule(),e.rule(n),t=n)}}}function global(e){return":global("+e+")"}function kv(e,n,t){return t={},t[e]=n,t}function at(e,n,t){if(arguments.length<3){var l=at.bind.apply(at,[null].concat([].slice.call(arguments,0)));return l.toString=function(){return"@"+e+" "+n},l}return kv("@"+e+" "+n,t)}function J2c(e){function n(e){return c.names[e]||(c.names[e]=e+c.suffix),c.names[e].match(/^\S+/)}function t(e,t,l,r,a){return t||l||r+n(a)}e=e||{};var l,r,a=[{init:function(){l=[],r=[]},done:function(e){if(0!=r.length)throw new Error("j2c error(s): "+JSON.stringify(r,null,2)+"in context:\n"+l.join(""));return e?l:l.join("")},err:function(e){r.push(e),l.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){l.push(e,c.endline)},atrule:function(e,n,t,r){l.push(e,t&&" ",t,r?" {":";",c.endline)},_atrule:function(){l.push("}",c.endline)},rule:function(e){l.push(e," {",c.endline)},_rule:function(){l.push("}",c.endline)},decl:function(e,n){l.push(e,":",n,";",c.endline)}}],i=[closeSelectors],s=[],c={at:at,global:global,kv:kv,names:{},endline:"\n",suffix:randChars(7),plugins:[],sheet:function(e){return a[0].init(),rules(o[0],a[0],"",e,1,0),a[0].done()},inline:function(e,n){return a[1].init(),declarations(o[1],a[1],"",e,!(n&&n.global)),a[1].done()}},o=[{localizeReplacer:t,localize:n,names:c.names,atruleHandlers:s,atrule:atRules,decl:declarations,rule:rules},{localizeReplacer:t,localize:n,names:c.names,decl:declarations}];type.call(e.plugins)===ARRAY&&flatIter(function(e){c.plugins.push(e),type.call(e)===FUNCTION&&(e=e(c)),e&&(type.call(e.filter)===FUNCTION&&i.push(e.filter),type.call(e.atrule)===FUNCTION&&s.push(e.atrule),type.call(e.sink)===FUNCTION&&(a=e.sink()))})(e.plugins),type.call(e.names)===OBJECT&&(c.names=e.names),type.call(e.suffix)===STRING&&(c.suffix=e.suffix),type.call(e.suffix)===NUMBER&&(c.suffix=randChars(e.suffix)),type.call(e.endline)===STRING&&(c.endline=e.endine),a[1]=a[1]||{init:a[0].init,done:a[0].done,raw:a[0].raw,err:a[0].err,decl:a[0].decl};for(var u=0;u<2;u++)for(var f=i.length;f--;)a[u]=freeze(defaults(i[f](a[u],!!u),a[u]));return freeze(c),c}var emptyObject={},type=emptyObject.toString,ARRAY=type.call([]),NUMBER=type.call(0),OBJECT=type.call(emptyObject),STRING=type.call(""),FUNCTION=type.call(type),own=emptyObject.hasOwnProperty,freeze=Object.freeze||function(e){return e},selectorTokenizer=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,ampersandTokenizer=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,chars="";module.exports=J2c;