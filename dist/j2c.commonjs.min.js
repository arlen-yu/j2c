"use strict";function defaults(e,t){for(var n in t)own.call(t,n)&&(!n.indexOf("$")||n in e||(e[n]=t[n]));return e}function cartesian(e,t){var n,r,a=[];for(r in t)if(own.call(t,r))for(n in e)own.call(e,n)&&a.push(e[n]+t[r]);return a}function splitSelector(e){for(var t,n=[],r=[],a=0;t=selectorTokenizer.exec(e);)switch(t[0]){case"(":a++;break;case")":a--;break;case",":if(a)break;n.push(t.index)}for(t=n.length;t--;)r.unshift(e.slice(n[t]+1)),e=e.slice(0,n[t]);return r.unshift(e),r}function ampersand(e,t){for(var n,r,a=[],l=[];r=ampersandTokenizer.exec(e);)"&"==r[0]&&a.push(r.index);for(r=a.length;r--;)l.unshift(e.slice(a[r]+1)),e=e.slice(0,a[r]);for(l.unshift(e),1===l.length&&l.unshift(""),n=[l[0]],r=1;r<l.length;r++)n=cartesian(n,cartesian(t,[l[r]]));return n.join(",")}function flatIter(e){return function t(n){if(type.call(n)===ARRAY)for(var r=0;r<n.length;r++)t(n[r]);else e(n)}}function randChars(e){for(;chars.length<e;)chars+=Math.floor(4294967296*Math.random()).toString(36);var t="_"+chars.slice(0,e);return chars=chars.slice(e),t}function decamelize(e){return"-"+e.toLowerCase()}function declarations(e,t,n,r,a){var l,i,s;if(null!=r)switch(type.call(r=r.valueOf())){case ARRAY:for(l=0;l<r.length;l++)declarations(e,t,n,r[l],a);break;case OBJECT:n=n&&n+"-";for(l in r)if(own.call(r,l))if(i=r[l],/\$/.test(l))for(s in l=l.split("$"))own.call(l,s)&&declarations(e,t,n+l[s],i,a);else declarations(e,t,n+l,i,a);break;default:if(!n)return t.raw(r);l=n.replace(/_/g,"-").replace(/[A-Z]/g,decamelize),!a||"animation-name"!=l&&"animation"!=l&&"list-style"!=l||(r=r.split(",").map(function(t){return t.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),t.decl(l,r)}}function atRules(e,t,n,r,a,l,i){for(var s=0;s<e.atruleHandlers.length;s++)if(e.atruleHandlers[s](e,t,n,r,a,l,i))return;if(!n[3]&&/^global$/.test(n[2]))rules(e,t,a,r,0,i);else if(!n[3]&&/^local$/.test(n[2]))rules(e,t,a,r,1,i);else if(n[3]&&/^adopt$/.test(n[2])){if(!l||i)return t.err("@adopt global or nested: "+n[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(n[3]))return t.err("bad adopter "+JSON.stringify(n[3])+" in "+n[0]);s=[],flatIter(function(e,r){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(r=e+"")?s.push(r.replace(/\./g,"")):t.err("bad adoptee "+JSON.stringify(e)+" in "+n[0])})(r),s.length&&(e.localize(n[3]=n[3].replace(/\./g,"")),e.names[n[3]]+=" "+s.join(" "))}else!n[3]&&/^(?:namespace|import|charset)$/.test(n[2])?flatIter(function(e){t.atrule(n[1],n[2],e)})(r):!n[3]&&/^(?:font-face|viewport)$/.test(n[2])?flatIter(function(r){t.atrule(n[1],n[2],n[3],"decl"),declarations(e,t,"",r,l),t._atrule()})(r):n[3]&&/^(?:media|supports|page|keyframes)$/.test(n[2])?(l&&"keyframes"==n[2]&&(n[3]=n[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,e.localizeReplacer)),"page"==n[2]?(t.atrule(n[1],n[2],n[3],"decl"),declarations(e,t,"",r,l)):(t.atrule(n[1],n[2],n[3],"rule"),rules(e,t,"keyframes"==n[2]?"":a,r,l,i+1)),t._atrule()):t.err("Unsupported at-rule: "+n[0])}function rules(e,t,n,r,a,l){var i,s,c,o;switch(type.call(r)){case OBJECT:for(i in r)if(own.call(r,i))if(s=r[i],n.length>0&&/^[-\w$]+$/.test(i))if(c||(c=1,t.rule(n)),/\$/.test(i))for(o in i=i.split("$"))own.call(i,o)&&declarations(e,t,i[o],s,a);else declarations(e,t,i,s,a);else/^@/.test(i)?(c=0,atRules(e,t,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*(.*?)\s*$/.exec(i)||[i,"@","",""],s,n,a,l)):(c=0,rules(e,t,n.length>0&&(/,/.test(n)||/,/.test(i))?(o=splitSelector(n),splitSelector(a?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i).map(function(e){return/&/.test(e)?ampersand(e,o):o.map(function(t){return t+e}).join(",")}).join(",")):/&/.test(i)?ampersand(a?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i,[n]):n+(a?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i),s,a,l+1));break;case ARRAY:for(i=0;i<r.length;i++)rules(e,t,n,r[i],a,l);break;case STRING:n.length&&t.rule(n),t.raw(r)}}function closeSelectors(e,t){var n;return t?e:{init:function(){n=0,e.init()},done:function(t){return n&&(e._rule(),n=0),e.done(t)},atrule:function(t,r,a,l){n&&(e._rule(),n=0),e.atrule(t,r,a,l)},_atrule:function(t){n&&(e._rule(),n=0),e._atrule(t)},rule:function(t){t!==n&&(n&&e._rule(),e.rule(t),n=t)}}}function invoke(e,t,n,r){r.init();try{e(n,r,"",t,1,0)}catch(e){r.err(e instanceof Error?e.stack:""+e)}return r.done()}function makeInstance(e,t,n,r,a,l){function i(n){return own.call(s,n)||(s[n]=e+n+t),s[n].match(/^\S+/)}for(var s={},c={atruleHandlers:n,names:s,localize:i,localizeReplacer:function(e,t,n,r,a){return t||n||r+i(a)}},o={ns:function(e){var i="__"+e.replace(/\W+/g,"_")+"_";return own.call(r,i)||(r[i]=makeInstance(i,t,n,r,a,l)),r[i]},names:s,prefix:e,suffix:t,sheet:function(e){return invoke(rules,e,c,a[0])},inline:function(e){return invoke(declarations,e,c,a[1])}},u=l.length;u--;)defaults(o,l[u]);return o}function J2c(e){e=e||{};var t,n,r=[{init:function(){t=[],n=[]},done:function(e){if(0!=n.length)throw new Error("j2c error(s): "+JSON.stringify(n,null,2)+"in context:\n"+t.join(""));return e?t:t.join("")},err:function(e){n.push(e),t.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){t.push(e,"\n")},atrule:function(e,n,r,a){t.push(e,r&&" ",r,a?" {\n":";\n")},_atrule:function(){t.push("}\n")},rule:function(e){t.push(e," {\n")},_rule:function(){t.push("}\n")},decl:function(e,n){t.push(e,":",n,";\n")}}],a=[closeSelectors],l=[],i=[],s=randChars(7),c={};type.call(e.plugins)===ARRAY&&flatIter(function(e){if(type.call(e)!==OBJECT)throw new Error("bad plugin, object expected, got "+type.call(e));type.call(e.filter)===FUNCTION&&a.push(e.filter),type.call(e.atrule)===FUNCTION&&l.push(e.atrule),type.call(e.sink)===FUNCTION&&(r=e.sink()),type.call(e.set)===OBJECT&&i.push(e.set)})(e.plugins),type.call(e.suffix)===STRING&&(s=e.suffix),type.call(e.suffix)===NUMBER&&(s=randChars(e.suffix)),r[1]=r[1]||{init:r[0].init,done:r[0].done,raw:r[0].raw,err:r[0].err,decl:r[0].decl};for(var o=0;o<2;o++)for(var u=a.length;u--;)r[o]=freeze(defaults(a[u](r[o],!!o),r[o]));return freeze(makeInstance("",s,l,c,r,i))}var emptyObject={},type=emptyObject.toString,ARRAY=type.call([]),NUMBER=type.call(0),OBJECT=type.call(emptyObject),STRING=type.call(""),FUNCTION=type.call(type),own=emptyObject.hasOwnProperty,freeze=Object.freeze||function(e){return e},selectorTokenizer=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,ampersandTokenizer=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,chars="";module.exports=J2c;